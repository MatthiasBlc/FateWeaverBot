-------------------------Todo-------------------------

## üéØ Prochaines √âtapes

### ‚úÖ √âtape 2 ‚Äì Refactor du bot (COMPL√âT√âE)

- ‚úÖ Composants modulaires et DRY
- ‚úÖ Services, utils et constantes regroup√©s
- ‚úÖ ARCHITECTURE.md cr√©√©

### üß™ √âtape 3 ‚Äì Tests et validation (EN COURS)

**Objectif** : Garantir que le bot reste fonctionnel apr√®s refactoring

**Actions :**

- Tests utilisateur des fonctionnalit√©s principales
- V√©rification des interactions (boutons, modals, menus)
- Validation des commandes admin et user

**Voir** : Section "Tests Utilisateur" ci-dessous

### üìù √âtape 4 ‚Äì Refactor du backend (√Ä VENIR)

**Objectif** : All√©ger la logique serveur, mutualiser les contr√¥leurs

**Actions pr√©vues :**

- R√©duire duplication middlewares
- Extraire constantes, helpers r√©utilisables
- Uniformiser les routes
- S√©parer services des contr√¥leurs

### üé® √âtape 5 ‚Äì Normalisation conventions (√Ä VENIR)

**Objectif** : Coh√©rence bot/backend, guide commun

**Fichier √† cr√©er** : CONVENTIONS.md

### ‚úÖ √âtape 6 ‚Äì Isolation contexte (COMPL√âT√â)

**Objectif** : Projet "Claude-friendly"

**R√©alis√© :**

- ‚úÖ Syst√®me 3-tier cr√©√© (.claude/context-optimization.md)
- ‚úÖ CLAUDE.md optimis√© (214 ‚Üí 52 lignes, -75%)
- ‚úÖ Docs organis√©es (.claude/ + docs/archive/)
- ‚úÖ √âconomie ~1,050 tokens par session

### üß™ √âtape 7 ‚Äì Tests (EN COURS)

**Voir** : Ecrire des tests fonctionnels
Objectif : valider que le front/back refactoris√©s s‚Äôint√®grent bien.
Prompts types :
√âcris des tests d‚Äôint√©gration qui v√©rifient la communication entre front et back.
Donne-moi un plan de validation complet (unitaires + int√©gration + E2E).

üí° Claude peut g√©n√©rer des scripts jest, playwright, ou supertest pour √ßa.

### üìò √âtape 8 ‚Äì Documentation (COMPL√âT√â)

**Fichiers cr√©√©s :**

- ‚úÖ bot/ARCHITECTURE.md
- ‚úÖ .claude/reference.md
- ‚úÖ .claude/collaboration.md
- ‚úÖ docs/refactoring-progress.md
- ‚úÖ docs/archive/README.md

### üß© √âtape 9 ‚Äì Optimisation finale Claude

Objectif : t‚Äôassurer que les prochaines sessions soient √©conomes.
Prompts types :

Aide-moi √† cr√©er un script d‚Äôinitialisation pour tes futures sessions, afin de charger uniquement le contexte essentiel.
(Claude peut te g√©n√©rer un petit script CLI ou un load_context.sh.)

-------------------------Node Discord /update-------------------------

## fichier config emoji

Regrouper les emoji dans un fichier de "config" pour que l'on puisse les changer partout tous d'un coup plus facilement

## Update des commandes

### Commandes Utilisateurs

/help
-> actualiser et rendre plus lisible avec des cat√©gories etc

/profil
->un bouton "manger" et un "manger +". si faim <=0 ou >=4 alors on affiche ces boutons.

    -> En Ville (pas dans une exp√©dition avec status : DEPARTED)
      -> le bouton "manger" fait manger 1 de nourriture venant de la ville, s'il n'y en a pas, il fait manger 1 vivre venant de la ville, s'il n'y en a pas erreur (plus rien √† manger en ville).
      -> le bouton "manger +" ouvre un message √©ph√©m√®re avec : √©tat de la faim, √©tat des stocks de vivres dans la ville et nourriture dans la ville avec une alerte de p√©nurie. La nourriture n'apparait que si la ressource nourriture existe dans le ResourceStock de la ville du character. Ce message propose 4 boutons:
        ->manger 1 vivre (venant du stock de la ville)
        -> manger 1 nourriture (venant du stock de la ville). Le bouton nourriture n'apparait que si le stock de nourriture >0 dans le ResourceStock de la ville du character
        -> manger √† sa faim des vivres (mange des vivres jusqu'a √™tre a 4/4 en faim), entre parenth√®se il doit y avoir le nombre de vivre consomm√©. S'il faut consommer 3 vivres mais qu'il en reste 2, alors mettre 2 entre parenth√®se et ne consommer que deux vivres. Le bouton ne s'affiche que s'il faut consommer plus d'un seul vivre pour √™tre √† 4/4.
        -> manger √† sa faim de la nourriture (mange des nourritures jusqu'a √™tre a 4/4 en faim), entre parenth√®se il doit y avoir le nombre de nourriture consomm√©. S'il faut consommer 3 nourritures mais qu'il en reste 2, alors mettre 2 entre parenth√®se et ne consommer que deux nourritures. Le bouton ne s'affiche que s'il faut consommer plus d'une seule nourriture pour √™tre √† 4/4. le bouton ne s'affiche que s'il y a au minimum 2 nourriture en stock de la ville.
    -> En Exp√©dition avec status : DEPARTED
      -> le bouton "manger" fait manger 1 de nourriture venant de l'Exp√©dition, s'il n'y en a pas, il fait manger 1 vivre venant de l'Exp√©dition, s'il n'y en a pas erreur (plus rien √† manger dans l'Exp√©dition).
      -> le bouton "manger +" ouvre un message √©ph√©m√®re avec : √©tat de la faim, √©tat des stocks de vivres dans l'Exp√©dition et nourriture dans l'Exp√©dition avec une alerte de p√©nurie. La nourriture n'apparait que si la ressource nourriture existe dans le ResourceStock de l'Exp√©dition du character. Ce message propose 4 boutons:
        ->manger 1 vivre (venant du stock de l'Exp√©dition)
        -> manger 1 nourriture (venant du stock de l'Exp√©dition). Le bouton nourriture n'apparait que si le stock de nourriture >0 dans le ResourceStock de l'Exp√©dition du character
        -> manger √† sa faim des vivres (mange des vivres jusqu'a √™tre a 4/4 en faim), entre parenth√®se il doit y avoir le nombre de vivre consomm√©. S'il faut consommer 3 vivres mais qu'il en reste 2, alors mettre 2 entre parenth√®se et ne consommer que deux vivres. Le bouton ne s'affiche que s'il faut consommer plus d'un seul vivre pour √™tre √† 4/4.
        -> manger √† sa faim de la nourriture (mange des nourritures jusqu'a √™tre a 4/4 en faim), entre parenth√®se il doit y avoir le nombre de nourriture consomm√©. S'il faut consommer 3 nourritures mais qu'il en reste 2, alors mettre 2 entre parenth√®se et ne consommer que deux nourritures. Le bouton ne s'affiche que s'il faut consommer plus d'une seule nourriture pour √™tre √† 4/4. le bouton ne s'affiche que s'il y a au minimum 2 nourriture en stock de l'Exp√©dition.

/stock
->ok comme √ßa pour l'instant, semble fonctionner correctement

/foodstock
-> Commande plus utilis√©e

/manger
-> Commande plus utilis√©e

/ping
-> Commande plus utilis√©e

/expedition
-> Ne devrait plus avoir de sous commandes (tout est g√©r√© par la commande /expedition directement avec des boutons)
-> Nombreux tests de fonctionnalit√© √† faire et de CRON.
-> le bouton pour cr√©er une exp√©dition a disparu. (voir les docs ce que l'on peut en tirer)
-> lorsque l'on est dans une exp√©dition qui n'est pas encore en status DEPARTED, un bouton "transferer la nourriture" doit ouvrir une modale avec deux champs danset g√©rer les deux ressources en transfert. il doit aussi g√©re de mani√®re ergonomique le transfert de vivres et / ou nourriture vers la ville et inversement. Un scond bouton quitter l'exp√©dition doit √™tre pr√©sent.
-> lorsque l'on est dans une exp√©dition en status DEPARTED, il devrait y avoir un bouton "retour de l'exp√©dition en urgence".
Ce bouton agit comme un toggelable, si au moins la moiti√© des membres d'une exp√©dition (hors isdead true ou agonie) appuie sur le bouton, alors l'exp√©dition est retourn√©e en urgence. Rappuyer sur le bouton doit annuler l'opt-in pour le retour en urgence. Un retour en urgence valid√© fait rentrer l'exp√©dition lors du prochain cron avec le status RETURNED, a condition que tous les membres ne soient pas en isdead = true √† ce moment l√†.
-> il faut faire le point sur la gestion de la faim et des PA sp√©cifiques en exp√©dition.

/chantiers
-> actuellement la commande a deux sous commandes : liste et build.
-> Remplacer par une commande sans sous commande : /chantier donne la liste des chantiers, un bouton "participer" renvoie sur l'ancien message de build : liste d√©roulante des chantiers, choix de celui pour lequel l'on veut participer, modale demandant le nombre de PA et g√©rant toutes les erreurs, investissement des PA dans le chantier.
->-> Actuellement, un chantier a un nom et ne coute que des PA. Il faudrait qu'un chantier puisse avoir un cout supll√©mentaire dans nimporte quelle ressource. (une ou plusieurs ressources) (voir commande chantier-admin)

### Commandes Administrateur

/admin-help
-> actualiser et rendre plus lisible avec des cat√©gories etc
->rename en help-admin

/config-channel
->rename en config-channel-admin
-> fonctionne bien

/season-admin
-> fonctionne bien

/character-admin
-> fonctionne bien

/stock-admin
-> fonctionne bien

/expedition-admin
-> A tester en profondeur

/chantiers-admin
-> Actuellement, un chantier a un nom et ne coute que des PA. Il faudrait qu'un chantier puisse avoir un cout supll√©mentaire dans nimporte quelle ressource. (une ou plusieurs ressources)

# Lister ce qui peut √™tre fait en ville et en exp√©dition, et ce qui ne peut pas √™tre fait si l'on est pas dans l'une ou l'autre des situations

##Tests urgents

Tester les interractions d'exp√©ditions avec plusieurs personnages
Commandes users non visibles par les users sur le server A Tale of a Star

## Capacit√©V2

beaucoup de trucs
Capacit√©
capacit√© hiver
capacit√© en "+"

Artisanat
Pour l‚Äôartisanat, tu veux probablement des stocks distincts dans la ville (minerai, tissu, m√©tal, planches, etc.).
‚Üí Il faudra √©largir le mod√®le Foodstock ou cr√©er un ResourceStock multi-type.

Instinct ?

## Daily messages:

dayli message (weather)
Pr√©voir 7 messages types x2
== 2 array de 7, clone array, rm du clone quand utilis√©, prendre random dans l'array

- message quotidien "belle journ√©e" ou "journ√©e pluvieuse" etc
- pouvoir lui donner un message diff√©rent la veille
  Message quotidien : ajouter stock vivres ?
  chantier termin√©s la veille
  r√©cap des ressources vivres etc
  annonce du d√©part de l'exp√©dition (pr√©par√©e la veille)

## Erreur sur la gestion des saisons √† v√©rifier :

gestion des saisons par VILLE et non pas globale !!!!!

##id√©es en vrac a r√©fl√©chir:

- syst√®me d'√©v√®nements

Gestion des p√©nuries ?? Alerte etc ?

Syst√®me de r√©approvisionnement automatique des vivres via des chantiers ??

logs de la cr√©ation de personnages

-------------------------Idea To work about -------------------------

s√©lectionner fil ?

D√©velopper les TESTS

#log update
"üçΩÔ∏è thorynest a pris un repas, il reste 60 de vivres dans la ville"
-> indiquer le nombre de vivres mang√©s ?

lors de la mort d'un personnage √©crire la raison

# Pouvoir faire manger les copains ? ou admin peuvent faire manger un joueur ?

Actions des charactes :

- ‚úÖ manger
- ‚úÖ syst√®me de faim

- que en ville ?
- faire manger
  - que en ville ?
    - ‚úÖ faire avancer un chantier
    - ‚úÖ voir commandes chantiers
- lancer un chantier / demander sa cr√©ation
  - asynchrone ?
- partir en exp√©dition
- r√®gle des exp√©ditions
- nombre de characters
- nombre d'√©vent etc
- que rapporte des expeds ?
- Il peut utiliser une comp√©tence activable
  - Soigner: il peut soigner quelqu'un (ou lui m√™me)
  - R√©conforter: il peut soigner la sant√© mentale de quelqu'un (ou lui m√™me)

Action des Admins:

- ‚úÖ donner des PA
- ‚úÖ retirer des PA
- ‚úÖ donner des PFaim
- ‚úÖ retirer des PFaim

- ‚úÖ donner des PV
- ‚úÖ retirer des PV
- ‚úÖ donner des PM
- ‚úÖ retirer des PM

- syst√®me d'√©v√®nements
  Action auto :
- message quotidien "belle journ√©e" ou "journ√©e pluvieuse" etc
- pouvoir lui donner un message diff√©rent la veille

#multi ville possible
Un character est li√© √† une ville et √† un user.
Il est li√© √† la guilde par la ville.
S'il n'y a pas de ville, un ville est cr√©er automatiquement.
une guilde peut avoir plusieurs villes. Une ville n'a qu'une seule guilde.

Les admins ont une commande pour choisir la ville actuelle. (liste d√©roulante)
Les admins ont une commande pour ajouter une ville √† la guilde.
Les admins ont une commande pour suprimer une ville √† la guilde (avec une modal de confirmation)
Toutes les commandes li√©es √† la ville et les characters sont li√©s √† la ville choisie.

Lors de l'interraction d'un User, on v√©rifie qu'il a bien un character sur la ville actuelle.
Si ce nest pas le cas, un nouveau character est cr√©er (couple ville / user)
-------------------------Done-------------------------

-------------------------Notes-------------------------
